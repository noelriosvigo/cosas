import os
import hashlib

def generar_addons_xml(ruta):
    addons = ''
    for carpeta in os.listdir(ruta):
        ruta_addon = os.path.join(ruta, carpeta, 'addon.xml')
        if os.path.isfile(ruta_addon):
            with open(ruta_addon, 'r', encoding='utf-8') as f:
                addons += f.read().strip() + '\n'
    contenido = f'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<addons>\n{addons}</addons>\n'
    with open(os.path.join(ruta, 'addons.xml'), 'w', encoding='utf-8') as f:
        f.write(contenido)
    md5 = hashlib.md5(contenido.encode('utf-8')).hexdigest()
    with open(os.path.join(ruta, 'addons.xml.md5'), 'w') as f:
        f.write(md5)

generar_addons_xml('./mi-repo-kodi')
